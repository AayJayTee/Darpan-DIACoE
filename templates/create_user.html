{% extends "base.html" %}
{% block title %}Create User{% endblock %}

{% block content %}
<br>
<h2 class="mb-4">Create User</h2>
<form method="POST" action="{{ url_for('create_user') }}" novalidate>
  <div class="mb-3">
    <label for="username" class="form-label">Username</label>
    <input type="text" name="username" id="username" class="form-control" required autocomplete="off">
  </div>
  <div class="mb-3">
    <label for="password" class="form-label">Password</label>
    <div style="position: relative;">
      <input type="password" name="password" id="password" class="form-control" required minlength="8"
        pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[@$!%*?&]).{8,}"
        title="Must contain at least one number, one uppercase letter, one lowercase letter, one special character, and at least 8 characters">
      <i id="togglePassword" class="fa-solid fa-eye-slash" style="cursor: pointer; position: absolute; right: 10px; top: 50%; transform: translateY(-50%); font-size: 1.2rem;"></i>
    </div>
    <small class="text-muted d-block mt-2">
      Password must:
      <ul class="mb-0 ps-4">
        <li>Be at least 8 characters long</li>
        <li>Contain at least one number</li>
        <li>Contain at least one uppercase letter</li>
        <li>Contain at least one lowercase letter</li>
        <li>Contain at least one special character (e.g., @, $, !, %, *, ?, &)</li>
      </ul>
    </small>
  </div>
  <div class="mb-3">
    <label for="role" class="form-label">Role</label>
    <select name="role" id="role" class="form-select" required onchange="togglePIField(this.value)">
      <option value="admin">Admin</option>
      <option value="viewer">Viewer</option>
      <option value="manager">Manager</option>
    </select>
  </div>
  <div class="mb-3" id="piNameRow" style="display: none;">
    <label for="pi_name" class="form-label">PI Name (for Manager)</label>
    <input type="text" name="pi_name" id="pi_name" class="form-control">
  </div>
  <button type="submit" class="btn btn-success mb-4">Create User</button>
  <a href="{{ url_for('manage_users') }}" class="btn btn-secondary ms-2 mb-4">Back to Manage Users</a>
</form>
<script>
function togglePIField(role) {
    document.getElementById('piNameRow').style.display = (role === 'manager') ? '' : 'none';
}

document.getElementById('togglePassword').addEventListener('click', function () {
    const passwordField = document.getElementById('password');
    const toggleIcon = document.getElementById('togglePassword');
    if (passwordField.type === 'password') {
        passwordField.type = 'text';
        toggleIcon.classList.remove('fa-eye-slash');
        toggleIcon.classList.add('fa-eye'); // Change icon to "show"
    } else {
        passwordField.type = 'password';
        toggleIcon.classList.remove('fa-eye');
        toggleIcon.classList.add('fa-eye-slash'); // Change icon to "hide"
    }
});

document.addEventListener('DOMContentLoaded', function() {
    togglePIField(document.getElementById('role').value);
});
</script>
{% endblock %}