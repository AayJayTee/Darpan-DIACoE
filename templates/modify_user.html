{% extends "base.html" %}
{% block content %}
<h2 class="mb-4">Modify User</h2>
<form method="POST" action="{{ url_for('modify_user') }}" novalidate>
    <div class="mb-3">
        <label for="username" class="form-label">Select User</label>
        <select name="username" id="username" class="form-select" required onchange="updateRoleAndPI()">
            <option value="" disabled selected>Select a user</option>
            {% for u in users %}
            <option value="{{ u.username }}" data-role="{{ u.role }}" data-pi="{{ u.pi_name or '' }}">
                {{ u.username }}
            </option>
            {% endfor %}
        </select>
    </div>
    <div class="mb-3">
        <label for="password" class="form-label">New Password (leave blank to keep unchanged)</label>
        <div style="position: relative;">
            <input type="password" name="password" id="password" class="form-control">
            <i id="togglePassword" class="fa-solid fa-eye-slash" style="cursor: pointer; position: absolute; right: 10px; top: 50%; transform: translateY(-50%); font-size: 1.2rem;"></i>
        </div>
    </div>
    <div class="mb-3">
        <label for="role" class="form-label">Role</label>
        <select name="role" id="role" class="form-select" required onchange="togglePIField(this.value)">
            <option value="admin">Admin</option>
            <option value="viewer">Viewer</option>
            <option value="manager">Manager</option>
        </select>
    </div>
    <div class="mb-3" id="piNameRow" style="display: none;">
        <label for="pi_name" class="form-label">PI Name (for Manager)</label>
        <input type="text" name="pi_name" id="pi_name" class="form-control">
    </div>
    <button type="submit" class="btn btn-warning mb-4">Update User</button>
    <a href="{{ url_for('manage_users') }}" class="btn btn-secondary ms-2 mb-4">Back to Manage Users</a>
</form>
<script>
function togglePIField(role) {
    document.getElementById('piNameRow').style.display = (role === 'manager') ? '' : 'none';
}
function updateRoleAndPI() {
    var select = document.getElementById('username');
    var selected = select.options[select.selectedIndex];
    var role = selected.getAttribute('data-role');
    var pi = selected.getAttribute('data-pi');
    document.getElementById('role').value = role;
    document.getElementById('pi_name').value = pi || '';
    togglePIField(role);
}
document.getElementById('togglePassword').addEventListener('click', function () {
    const passwordField = document.getElementById('password');
    const toggleIcon = document.getElementById('togglePassword');
    if (passwordField.type === 'password') {
        passwordField.type = 'text';
        toggleIcon.classList.remove('fa-eye-slash');
        toggleIcon.classList.add('fa-eye'); // Change icon to "show"
    } else {
        passwordField.type = 'password';
        toggleIcon.classList.remove('fa-eye');
        toggleIcon.classList.add('fa-eye-slash'); // Change icon to "hide"
    }
});
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('username').addEventListener('change', updateRoleAndPI);
    togglePIField(document.getElementById('role').value);
});
</script>
{% endblock %}